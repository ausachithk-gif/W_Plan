<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Work Hours">
    <title>Work Hours Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-user-select: none;
            user-select: none;
        }
        input, select {
            -webkit-user-select: text;
            user-select: text;
            font-size: 16px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="min-h-screen p-4 pb-8">
        <div class="max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold text-indigo-900 mb-6 text-center">Work Hours Manager</h1>
            
            <!-- Tab Navigation -->
            <div class="flex gap-2 mb-6">
                <button onclick="switchTab('tracking')" id="trackingBtn" 
                    class="flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-indigo-600 text-white shadow-lg">
                    ‚è±Ô∏è Time Tracking
                </button>
                <button onclick="switchTab('plan')" id="planBtn"
                    class="flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-white text-indigo-600">
                    üìÖ Working Plan
                </button>
            </div>
            
            <!-- Time Tracking Tab -->
            <div id="trackingTab">
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-indigo-900 mb-4">Enter Your Time</h2>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                            <input type="date" id="selectedDate" 
                                class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hours</label>
                                <input type="number" id="hours" placeholder="0" min="0" oninput="calculateDecimal()"
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Minutes</label>
                                <input type="number" id="minutes" placeholder="0" min="0" max="59" oninput="calculateDecimal()"
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Hours</label>
                                <input type="text" id="decimal" readonly
                                    class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 font-bold text-indigo-900">
                            </div>
                        </div>
                        <button onclick="addTimeEntry()"
                            class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">
                            üíæ Save Entry
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-indigo-900 mb-4">Previous 14 Days</h2>
                        <div id="previous14Days" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-indigo-900 mb-4">Safe Hours - Next 7 Days</h2>
                        <p class="text-sm text-gray-600 mb-4">Maximum 48 hours per 14-day rolling period</p>
                        <div id="safeHours7Days" class="space-y-2"></div>
                    </div>
                </div>
            </div>
            
            <!-- Working Plan Tab -->
            <div id="planTab" style="display: none;">
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-indigo-900 mb-4">Weekly Working Plan</h2>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Week Starting (Monday)</label>
                            <input type="date" id="weekStart" onchange="renderWorkPlan()"
                                class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    
                    <div id="workPlanContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let timeEntries = {};
        let workPlan = {};
        let activeTab = 'tracking';
        
        function init() {
            const savedEntries = localStorage.getItem('timeEntries');
            const savedWorkPlan = localStorage.getItem('workPlan');
            const savedWeekStart = localStorage.getItem('weekStart');
            
            if (savedEntries) timeEntries = JSON.parse(savedEntries);
            if (savedWorkPlan) workPlan = JSON.parse(savedWorkPlan);
            
            document.getElementById('selectedDate').value = new Date().toISOString().split('T')[0];
            
            if (savedWeekStart) {
                document.getElementById('weekStart').value = savedWeekStart;
            } else {
                const today = new Date();
                const monday = new Date(today);
                const day = today.getDay();
                const diff = day === 0 ? -6 : 1 - day;
                monday.setDate(today.getDate() + diff);
                document.getElementById('weekStart').value = monday.toISOString().split('T')[0];
            }
            
            renderTracking();
            renderWorkPlan();
        }
        
        function switchTab(tab) {
            activeTab = tab;
            if (tab === 'tracking') {
                document.getElementById('trackingTab').style.display = 'block';
                document.getElementById('planTab').style.display = 'none';
                document.getElementById('trackingBtn').className = 'flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-indigo-600 text-white shadow-lg';
                document.getElementById('planBtn').className = 'flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-white text-indigo-600';
            } else {
                document.getElementById('trackingTab').style.display = 'none';
                document.getElementById('planTab').style.display = 'block';
                document.getElementById('trackingBtn').className = 'flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-white text-indigo-600';
                document.getElementById('planBtn').className = 'flex-1 py-3 px-4 rounded-lg font-semibold transition-all bg-indigo-600 text-white shadow-lg';
            }
        }
        
        function calculateDecimal() {
            const hours = parseFloat(document.getElementById('hours').value) || 0;
            const minutes = parseFloat(document.getElementById('minutes').value) || 0;
            const decimal = (hours + minutes / 60).toFixed(2);
            document.getElementById('decimal').value = decimal;
        }
        
        function addTimeEntry() {
            const date = document.getElementById('selectedDate').value;
            const decimal = parseFloat(document.getElementById('decimal').value);
            
            if (decimal > 0) {
                timeEntries[date] = decimal;
                localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
                document.getElementById('hours').value = '';
                document.getElementById('minutes').value = '';
                document.getElementById('decimal').value = '';
                renderTracking();
            }
        }
        
        function renderTracking() {
            renderPrevious14Days();
            renderSafeHours();
        }
        
        function renderPrevious14Days() {
            const container = document.getElementById('previous14Days');
            container.innerHTML = '';
            
            const today = new Date();
            for (let i = 13; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const hours = timeEntries[dateStr] || 0;
                
                const div = document.createElement('div');
                div.className = 'flex justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span class="font-medium text-gray-700">${dateStr}</span>
                    <span class="font-bold text-indigo-900">${hours.toFixed(2)} hrs</span>
                `;
                container.appendChild(div);
            }
        }
        
        function renderSafeHours() {
            const container = document.getElementById('safeHours7Days');
            container.innerHTML = '';
            
            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const targetDate = new Date(today);
                targetDate.setDate(today.getDate() + i);
                const targetDateStr = targetDate.toISOString().split('T')[0];
                
                let totalHours = 0;
                for (let j = 13; j >= 0; j--) {
                    const checkDate = new Date(targetDate);
                    checkDate.setDate(targetDate.getDate() - j);
                    const checkDateStr = checkDate.toISOString().split('T')[0];
                    totalHours += timeEntries[checkDateStr] || 0;
                }
                
                const safe = Math.max(0, 48 - totalHours).toFixed(2);
                
                const div = document.createElement('div');
                div.className = 'flex justify-between p-3 bg-green-50 rounded-lg border border-green-200';
                div.innerHTML = `
                    <span class="font-medium text-gray-700">${targetDateStr}</span>
                    <span class="font-bold text-green-700">${safe} hrs available</span>
                `;
                container.appendChild(div);
            }
        }
        
        function renderWorkPlan() {
            const weekStart = document.getElementById('weekStart').value;
            if (!weekStart) return;
            
            localStorage.setItem('weekStart', weekStart);
            
            const container = document.getElementById('workPlanContainer');
            container.innerHTML = '';
            
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg p-5 mb-4';
                
                const dayPlan = workPlan[dateStr] || {};
                
                card.innerHTML = `
                    <div class="border-b-2 border-indigo-100 pb-3 mb-4">
                        <div class="text-xl font-bold text-indigo-900">${days[i]}</div>
                        <div class="text-sm text-gray-600">${dateStr}</div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Work Shift 1</label>
                            <select class="w-full p-3 border-2 border-gray-300 rounded-lg" 
                                onchange="saveWork('${dateStr}', 'work1', this.value)">
                                <option value="">Not working</option>
                                <option value="5am-12pm" ${dayPlan.work1 === '5am-12pm' ? 'selected' : ''}>5am - 12pm</option>
                                <option value="5am-2pm" ${dayPlan.work1 === '5am-2pm' ? 'selected' : ''}>5am - 2pm</option>
                                <option value="2pm-10pm" ${dayPlan.work1 === '2pm-10pm' ? 'selected' : ''}>2pm - 10pm</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Work Shift 2</label>
                            <select class="w-full p-3 border-2 border-gray-300 rounded-lg" 
                                onchange="saveWork('${dateStr}', 'work2', this.value)">
                                <option value="">Not working</option>
                                <option value="5am-12pm" ${dayPlan.work2 === '5am-12pm' ? 'selected' : ''}>5am - 12pm</option>
                                <option value="5am-2pm" ${dayPlan.work2 === '5am-2pm' ? 'selected' : ''}>5am - 2pm</option>
                                <option value="2pm-10pm" ${dayPlan.work2 === '2pm-10pm' ? 'selected' : ''}>2pm - 10pm</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Work Shift 3</label>
                            <input type="text" placeholder="e.g. 6am-3pm" value="${dayPlan.work3 || ''}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg"
                                onchange="saveWork('${dateStr}', 'work3', this.value)">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Work Shift 4</label>
                            <input type="text" placeholder="e.g. 6am-3pm" value="${dayPlan.work4 || ''}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg"
                                onchange="saveWork('${dateStr}', 'work4', this.value)">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Work Shift 5</label>
                            <input type="text" placeholder="e.g. 6am-3pm" value="${dayPlan.work5 || ''}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg"
                                onchange="saveWork('${dateStr}', 'work5', this.value)">
                        </div>
                        
                        <div class="mt-4 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                            <div class="text-sm font-semibold text-gray-700 mb-1">üïê Free Time</div>
                            <div class="text-base font-bold text-yellow-900" id="free-${dateStr}"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
                updateFreeTime(dateStr);
            }
        }
        
        function saveWork(date, field, value) {
            if (!workPlan[date]) workPlan[date] = {};
            workPlan[date][field] = value;
            localStorage.setItem('workPlan', JSON.stringify(workPlan));
            updateFreeTime(date);
        }
        
        function updateFreeTime(date) {
            const dayPlan = workPlan[date] || {};
            const works = [];
            
            ['work1', 'work2', 'work3', 'work4', 'work5'].forEach(field => {
                const value = dayPlan[field];
                if (value && value.trim() !== '') works.push(value);
            });
            
            const freeTime = calculateFreeTime(works);
            const element = document.getElementById(`free-${date}`);
            if (element) element.textContent = freeTime;
        }
        
        function calculateFreeTime(works) {
            if (works.length === 0) return '24 hours free';
            
            const ranges = [];
            works.forEach(work => {
                const parts = work.split('-');
                if (parts.length === 2) {
                    const start = timeToMinutes(parts[0].trim());
                    const end = timeToMinutes(parts[1].trim());
                    if (start !== null && end !== null) {
                        ranges.push({ start, end: end === 0 ? 1440 : end });
                    }
                }
            });
            
            if (ranges.length === 0) return 'Invalid time format';
            
            ranges.sort((a, b) => a.start - b.start);
            
            const freeSlots = [];
            if (ranges[0].start > 0) {
                freeSlots.push(`12am-${formatTime(ranges[0].start)}`);
            }
            
            for (let i = 0; i < ranges.length - 1; i++) {
                if (ranges[i].end < ranges[i + 1].start) {
                    freeSlots.push(`${formatTime(ranges[i].end)}-${formatTime(ranges[i + 1].start)}`);
                }
            }
            
            if (ranges[ranges.length - 1].end < 1440) {
                freeSlots.push(`${formatTime(ranges[ranges.length - 1].end)}-12am`);
            }
            
            return freeSlots.length > 0 ? freeSlots.join(', ') : 'No free time';
        }
        
        function timeToMinutes(timeStr) {
            if (!timeStr) return null;
            const match = timeStr.match(/(\d+)(am|pm)/i);
            if (!match) return null;
            let hours = parseInt(match[1]);
            const period = match[2].toLowerCase();
            if (period === 'pm' && hours !== 12) hours += 12;
            if (period === 'am' && hours === 12) hours = 0;
            return hours * 60;
        }
        
        function formatTime(minutes) {
            let hours = Math.floor(minutes / 60);
            const period = hours >= 12 ? 'pm' : 'am';
            if (hours > 12) hours -= 12;
            if (hours === 0) hours = 12;
            return `${hours}${period}`;
        }
        
        window.onload = init;
    </script>
</body>
</html>